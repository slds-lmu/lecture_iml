\documentclass{article}
\usepackage{amsmath, booktabs}
\usepackage[a4paper,margin=2.5cm]{geometry}
\usepackage{tikz}
\title{Exercise: FAST Interaction Detection with Prefix Sums}
\date{}
\begin{document}
\maketitle

\section*{Exercise}
You are given the following dataset of 9 samples, each with two numeric features $x_1$, $x_2$ and a numeric target $y$:

\begin{center}
\begin{tabular}{cccc}
\toprule
Index & $x_1$ & $x_2$ & $y$ \\
\midrule
0 & 1 & 1 & 2 \\
1 & 2 & 1 & 3 \\
2 & 3 & 1 & 4 \\
3 & 1 & 2 & 5 \\
4 & 2 & 2 & 6 \\
5 & 3 & 2 & 7 \\
6 & 1 & 3 & 8 \\
7 & 2 & 3 & 9 \\
8 & 3 & 3 & 10 \\
\bottomrule
\end{tabular}
\end{center}

\bigskip

\textbf{Tasks:}
\begin{enumerate}
    \item Discretize $x_1$ and $x_2$ into 3 equal-width bins: $[0,1.5)$, $[1.5,2.5)$, $[2.5,3.5)$, mapping to bin indices 0, 1, and 2.

    \item Construct 3 matrices $T(i,j)$, $Q(i,j)$, and $N(i,j)$ of size $3 \times 3$ where:
    \begin{itemize}
        \item $T(i,j)$ = sum of $y$ in bin $(i,j)$
        \item $Q(i,j)$ = sum of $y^2$ in bin $(i,j)$
        \item $N(i,j)$ = number of observations in bin $(i,j)$
    \end{itemize}

    \item Compute the prefix sums for each of $T$, $Q$, and $N$ using 2D cumulative summation.

    \item Using inclusion--exclusion, compute the total $T_r$, $Q_r$, and $N_r$ in the bottom-right $2 \times 2$ region: $x_1 \in \{1,2\}$ and $x_2 \in \{1,2\}$.

    \item Compute the mean prediction $\hat{y}_r = T_r / N_r$.

    \item Compute the Residual Sum of Squares (RSS) as:
    \[
    \text{RSS} = Q_r - \frac{T_r^2}{N_r}
    \]
\end{enumerate}

\section*{Solution}

\subsection*{Binned Data}
Bin indices $(x_1, x_2) \to (x_1^b, x_2^b)$:

\begin{center}
\begin{tabular}{ccccc}
\toprule
Index & $x_1$ & $x_2$ & $y$ & $(x_1^b, x_2^b)$ \\
\midrule
0 & 1 & 1 & 2 & (0,0) \\
1 & 2 & 1 & 3 & (1,0) \\
2 & 3 & 1 & 4 & (2,0) \\
3 & 1 & 2 & 5 & (0,1) \\
4 & 2 & 2 & 6 & (1,1) \\
5 & 3 & 2 & 7 & (2,1) \\
6 & 1 & 3 & 8 & (0,2) \\
7 & 2 & 3 & 9 & (1,2) \\
8 & 3 & 3 & 10 & (2,2) \\
\bottomrule
\end{tabular}
\end{center}

\subsection*{Aggregate Matrices}

\begin{itemize}
    \item $T$ (sum of $y$):
    \[ T = \begin{bmatrix} 2 & 5 & 8 \\ 3 & 6 & 9 \\ 4 & 7 & 10 \end{bmatrix} \]

    \item $Q$ (sum of $y^2$):
    \[ Q = \begin{bmatrix} 4 & 25 & 64 \\ 9 & 36 & 81 \\ 16 & 49 & 100 \end{bmatrix} \]

    \item $N$ (counts):
    \[ N = \begin{bmatrix} 1 & 1 & 1 \\ 1 & 1 & 1 \\ 1 & 1 & 1 \end{bmatrix} \]
\end{itemize}

\subsection*{Prefix Sums}
Apply cumulative summation along both axes:

\begin{itemize}
    \item $T^{\text{prefix}} = \begin{bmatrix} 2 & 7 & 15 \\ 5 & 16 & 33 \\ 9 & 27 & 54 \end{bmatrix}$
    \item $Q^{\text{prefix}} = \begin{bmatrix} 4 & 29 & 93 \\ 13 & 74 & 219 \\ 29 & 139 & 319 \end{bmatrix}$
    \item $N^{\text{prefix}} = \begin{bmatrix} 1 & 2 & 3 \\ 2 & 4 & 6 \\ 3 & 6 & 9 \end{bmatrix}$
\end{itemize}

\subsection*{Region: Bottom-right $2 \times 2$}
Bin range: $x_1^b \in \{1,2\},\ x_2^b \in \{1,2\}$, i.e., region from $(1,1)$ to $(2,2)$.
Use inclusion--exclusion:
\begin{align*}
T_r &= T_{2,2} - T_{0,2} - T_{2,0} + T_{0,0} = 54 - 15 - 9 + 2 = 32 \\
Q_r &= Q_{2,2} - Q_{0,2} - Q_{2,0} + Q_{0,0} = 319 - 93 - 29 + 4 = 201 \\
N_r &= N_{2,2} - N_{0,2} - N_{2,0} + N_{0,0} = 9 - 3 - 3 + 1 = 4
\end{align*}

\subsection*{RSS Computation}
\begin{align*}
\hat{y}_r &= \frac{T_r}{N_r} = \frac{32}{4} = 8 \\
\text{RSS} &= Q_r - \frac{T_r^2}{N_r} = 201 - \frac{32^2}{4} = 201 - 256 = \boxed{10}
\end{align*}

\end{document}
